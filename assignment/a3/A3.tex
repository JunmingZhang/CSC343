\documentclass[10pt]{article}

\usepackage{ulem}
\usepackage{multicol}
\usepackage{hyperref}
\usepackage{color}
\usepackage{graphicx}
\usepackage[edges]{forest}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{amsmath, amssymb, mathrsfs, amsthm, mdframed}
\usepackage{algpseudocode}
 
\usepackage[margin=2cm]{geometry}
\usepackage{fancyhdr, lastpage, pgfplots}
\usepackage{mathtools}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\pagestyle{fancy}
\renewcommand\qedsymbol{$\blacksquare$}

\fancyhf{}
\lhead{CSC343H1, Summer 2019}
\rhead{Assignment 3}
\rfoot{Page \thepage/\pageref{LastPage}}

\setlength\parindent{0pt}
\begin{document}

\begin{center}
\Large \textbf{CSC343H1: Assignment 3}

\vspace{1mm}
\large {\href{mailto:junmingpeter.zhang@mail.utoronto.ca?Subject=CSC343H1: Assignment 3}{Junming Zhang}\\
\href{mailto:yuchen.fan@mail.utoronto.ca?Subject=CSC343: Assignment3}{Yuchen Fan}} 

\vspace{1mm}
\large {Due: August 5th, 2019 before 10 p.m.}
\end{center}

\section*{Database Design and SQL DDL}

\begin{enumerate}
    \item Consider the relation $R(A, B, C, D, E, F)$.
    Let the set of FD’s for R be $\{A \rightarrow B,CD \rightarrow A,CB \rightarrow D,CE \rightarrow D,AE \rightarrow F\}$.
    \begin{enumerate}
        \item What are all of the keys for R?
        
        \begin{mdframed}[leftmargin=-6.5mm]
        
        \textit{Solution}.\\
        %type 1(a) here
        \underline{CE is the only key for relation R.}\\
        \newline
        Each key consists of attribute C and E since no RHS of an FD contains C and E. Also, since 
        $CE^+ = ABCDEF$, CE is the minimal superkey, thus the key. And also, since any combination 
        of another attribute and CE has more attributes than simply CE, then there is no other keys.
        \end{mdframed}
        
        \item Do the given FD’s form a minimal basis? Prove or disprove.
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 1(b) here
        \underline{The given FDs form a minimal basis.}
        
        \begin{proof}
        To prove the given set is a minimal basis, run the algorithm Minimal\_basis($\mathcal{S}$) which has an FDs set as the input and output the minimal basis form of $\mathcal{S}$. If the output is the same as the input, then $\mathcal{S}$ is a minimal basis.\\
        Thus execute this algorithm and take the set $\mathcal{S}$ formed by the given FDs.
        \begin{enumerate}[leftmargin=16mm]
            \item[\textbf{Step 1: }]split RHS for each FD. Denote the new set as $S_1$.\\
            No RHS of any FD can be split since each of them is singleton.
            
            \item[\textbf{Step 2: }]Reduce the LHS of each FD if applicable. Denote the new set as $S_2$.
            \begin{itemize}
                \item[(a)] $A \rightarrow B:$ not reducible since the LHS is singleton.
                \item[(b)] $CD \rightarrow A:$ $C^+ = C \And D^+ = D$, which means, in fact, no singleton of this LHS yields anything. Thus the LHS of this FD is not reducible.
                \item[(c)] $CB \rightarrow D:$ $B^+ = B$, which means no singleton of this LHS yields anything. Thus the LHS of this FD is not reducible.
                \item[(d)] $CE \rightarrow D:$ $E^+ = E$, which means no singleton of this LHS yields anything. Thus the LHS of this FD is not reducible.
                \item[(e)] $AE \rightarrow F:$ $AE^+ = ABE$, which means $AE$ does not yield $F$, thus not reducible.
            \end{itemize}
            
            \item[\textbf{Step 3: }]Try to eliminate each FD. Denote the new set as $S_3$.
            \begin{itemize}
                \item[(a)] $A{^+}_{S_2 - (a)} = A$. We need this FD.
                \item[(b)] $CD{^+}_{S_2 - (b)} = CD$. We need this FD.
                \item[(c)] $CB{^+}_{S_2 - (c)} = CB$. We need this FD.
                \item[(d)] $CE{^+}_{S_2 - (d)} = CE$. We need this FD.
                \item[(e)] $AE{^+}_{S_2 - (e)} = ABE$. We need this FD.
            \end{itemize}
        \end{enumerate}
        Through the whole algorithm, no FD in $\mathcal{S}$ is ever reduced, hence $S_3 = \mathcal{S}$. Since $S_3$ is generated by the algorithm Minimal\_basis($\mathcal{S}$), $S_3$ is a minimal basis for $R$, and therefore $\mathcal{S}$ is a minimal basis for $R$.
        
        \end{proof}
        \end{mdframed}
        
        \item Provide a decomposition of R into 3NF-satisfying relations.
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 1(c) here
        Let $\mathcal{S}$ be the set of FDs given in the problem and $L = \{A,B,C,D,E,F\}$, a set of attributes in $R$. Run the algorithm 3NF\_synthesis($\mathcal{S}, L$) to decompose R into 3NF-satisfying relations.
        
        \begin{enumerate}[leftmargin=16mm]
            \item[\textbf{Step 1: }]Verify if $\mathcal{S}$ is a minimal basis (The fact that $\mathcal{S}$ is a minimal basis has been proved in 1(b)).
            \item[\textbf{Step 2: }]Union X, Y for each $X \rightarrow Y \in \mathcal{S}$ to define a new relation.\\
            New relations derived are listed below:
            \begin{gather*}
                R1(A, B)\\
                R2(A, C, D)\\
                R3(B, C, D)\\
                R4(C, D, E)\\
                R5(A, E, F)
            \end{gather*}
            
            \item[\textbf{Step 3: }]Check if there is any new relation a superkey for relation R, if not, add a relation with a schema as a key for the relation R. \\
            CE is a key by of R by 1(a), thus R4 is a superkey for R. There is no need to add a new relation whose schema is the key for R.
            \item[\textbf{Step 4: }]Return the final schema produced by the 3NF algorithm.\\
            The final schema returned by this algorithm is:
            \begin{gather*}
                R1(A, B)\\
                R2(A, C, D)\\
                R3(B, C, D)\\
                R4(C, D, E)\\
                R5(A, E, F)
            \end{gather*}
        \end{enumerate}
        \end{mdframed}
        
        \item Are any of the relations that you made in part (c) not in BCNF?
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 1(d) here
        % may be modified after
        \underline{Every new relation is in BCNF.}\\
        \newline
        % since each of them inherit the FD $X \rightarrow Y$ which derives them by unioning $X$ and $Y$. The FD inherited is the only FD for each of them, and the attributes in the inherited FD contains all attributes in the corresponding new relation, which means for each new relation, the LHS $X$ of its inherited FD $X \rightarrow Y$ has the closure contains both $X$ and $Y$, which are all attributes in the new relation. Thus $X$ is the superkey. Since there is no other FD except the inherited one, each new relation is in BCNF.
        
        Let $\mathcal{S}$ be the set of FDs given in the problem and $L = \{A,B,C,D,E,F\}$, a set of attributes in $R$. First of all, project FDs in $\mathcal{S}$ on to all new relations. Also, let $L_1, L_2, L_3, L_4, L_5$ be attribute sets of new relations $R1, R2, R3, R4, R5$ respectively. Execute:
        \begin{algorithmic}[1] % The number tells where the line numbering should start
            \Procedure{Do\_Projection}{$\mathcal{S}, [L_1...L_5]$}
                \State $i \gets 1$
                \State $NewFDSetArray \gets Array[1...length([L_1...L_5])]$ \Comment{contains new FD sets for new relations generated in 1(c)}
                \While{$i \leq length([L_1...L_5])$}
                    \State $S_i \gets Project(\mathcal{S}, L_i)$ \Comment{project FDs in $\mathcal{S}$ on to each $L_i$}
                    \State $NewFDASetArray[i] = S_i$
                    \State $i \gets i + 1$
                \EndWhile
                \State \textbf{return} $NewFDSetArray$\Comment{return new FD sets generated}
            \EndProcedure
        \end{algorithmic}
        And tables of projection are listed below.
        \begin{itemize}
            \item [I.] $R1(A, B)$\\
            $L_1 = \{A, B\}$
            \begin{center}
                \begin{tabular}{|c|c|c|c|}
                    \hline
                     A & B & closure & FDs  \\
                     \hline
                     \hline
                     \checkmark & & $A^+ = AB$ & $A \rightarrow B$ \\
                     \hline
                     & \checkmark & $B^+ = B$ & \textit{Nothing} \\
                     \hline
                \end{tabular}
            \end{center}
            Thus $S_1 = \{A \rightarrow B\}$, and $A$ is the superkey of $R1$. Thus $R1$ is in BCNF.
            
            \item[II.] $R2(A, C, D)$\\
            $L_2 = \{A, C, D\}$
            \begin{center}
                \begin{tabular}{|c|c|c|c|c|}
                    \hline
                    A & C & D & closure & FDs \\
                    \hline
                    \hline
                    \checkmark & & & $A^+ = AB$ & \textit{Nothing} \\
                    \hline
                    & \checkmark & & $C^+ = C$ & \textit{Nothing} \\
                    \hline
                    & & \checkmark & $D^+ = D$ & \textit{Nothing} \\
                    \hline
                    \checkmark & \checkmark & & $AC^+ = AC$ & \textit{Nothing} \\
                    \hline
                    \checkmark & & \checkmark & $AD^+ = AD$ & \textit{Nothing} \\
                    \hline
                    & \checkmark & \checkmark & $CD^+ = ACD$ & $CD \rightarrow A$ \\
                    \hline
                \end{tabular}
            \end{center}
            Thus $S_2 = \{CD \rightarrow A\}$, and $CD$ is the superkey of $R2$. Thus $R2$ is in BCNF.
            
            \item[III.] $R3(B, C, D)$\\
            $L_3 = \{B, C, D\}$
            \begin{center}
                \begin{tabular}{|c|c|c|c|c|c|}
                    \hline
                    B & C & D & closure & FDs \\
                    \hline
                    \hline
                    \checkmark & & & $B^+ = B$ & \textit{Nothing}  \\
                    \hline
                     & \checkmark & & $C^+ = C$ & \textit{Nothing} \\
                     \hline
                     & & \checkmark & $D^+ = D$ & \textit{Nothing} \\
                     \hline
                     \checkmark & \checkmark & & $BC^+ = BCD$ & $BC \rightarrow D$ \\
                     \hline
                     \checkmark & & \checkmark & $BD^+ = BD$ & \textit{Nothing} \\
                     \hline
                     & \checkmark & \checkmark & $CD^+ = ACD$ & \textit{Nothing} \\
                     \hline
                \end{tabular}
            \end{center}
            Thus $S_3 = \{BC \rightarrow D\}$, and $BC$ is the superkey of $R3$. Thus $R3$ is in BCNF.
            
            \item[IV.] $R4(C, D, E)$ \\
            $L_4 = \{C, D, E\}$
             \begin{center}
                \begin{tabular}{|c|c|c|c|c|c|}
                    \hline
                    C & D & E & closure & FDs \\
                    \hline
                    \hline
                    \checkmark & & & $C^+ = C$ & \textit{Nothing}  \\
                    \hline
                     & \checkmark & & $D^+ = D$ & \textit{Nothing} \\
                     \hline
                     & & \checkmark & $E^+ = E$ & \textit{Nothing} \\
                     \hline
                     \checkmark & \checkmark & & $CD^+ = ACD$ & \textit{Nothing} \\
                     \hline
                     \checkmark & & \checkmark & $CE^+ = CDE$ & $CE \rightarrow D$ \\
                     \hline
                     & \checkmark & \checkmark & $DE^+ = DE$ & \textit{Nothing} \\
                     \hline
                \end{tabular}
            \end{center}
             Thus $S_4 = \{CE \rightarrow D\}$, and $BC$ is the superkey of $R4$. Thus $R4$ is in BCNF.
             
             \item[V.] $R5(A, E, F)$ \\
             $L_5 = \{A, E, F\}$
              \begin{center}
                \begin{tabular}{|c|c|c|c|c|c|}
                    \hline
                    A & E & F & closure & FDs \\
                    \hline
                    \hline
                    \checkmark & & & $A^+ = AB$ & \textit{Nothing}  \\
                    \hline
                     & \checkmark & & $E^+ = E$ & \textit{Nothing} \\
                     \hline
                     & & \checkmark & $F^+ = F$ & \textit{Nothing} \\
                     \hline
                     \checkmark & \checkmark & & $AE^+ = AEF$ & $AE \rightarrow F$ \\
                     \hline
                     \checkmark & & \checkmark & $AF^+ = AF$ & \textit{Nothing} \\
                     \hline
                     & \checkmark & \checkmark & $EF^+ = EF$ & \textit{Nothing} \\
                     \hline
                \end{tabular}
            \end{center}
             Thus $S_5 = \{AE \rightarrow F\}$, and $AE$ is the superkey of $R5$. Thus $R5$ is in BCNF.
        \end{itemize}
        According to the projection result of all new relations, there is no new relation not in BCNF.
    \end{mdframed}
        
    \end{enumerate}
    
    \item Answer the following questions.
    \begin{enumerate}
        \item Prove or disprove the following:\\
              Suppose a relation R is decomposed into R1 and R2 with one common attribute between the two new relations.\\
              If the common attribute between R1 and R2 forms a key for at least one of R1 or R2, then the decomposition is lossless.
              
              \begin{mdframed}[leftmargin=-6.5mm]
              \textit{Solution}.\\
              %type 2(a) here
              \underline{Yes,} according to definition of lossless decomposition, we need to prove that at least one of the following functional dependencies are in $F^+$(where $F^+$ stands for the closure for every attribute or attribute sets in F):\\
              \begin{itemize}
                  \item[1)] $R1 \cap R2 \to R1$
                  \item[2)] $R1 \cap R2 \to R2$
              \end{itemize}
              Assume the common attribute in R1 and R2 is A, and A is key for at least one of R1 or R2. These imply that $R1 \cap R2 = A$. Also A is a superkey for at least one of R1 and R2, meaning we have a functional dependency $\{A \to other\_attributes\_in\_one\_relation\}$. In other words, we have proven that $R1 \cap R2 \to R1$ or $R1 \cap R2 \to R2$ that $\in F^+$.
              \end{mdframed}
              
        \item Can a relation and a set of FDs be in both BCNF and 3NF at the same time? If so,            explain what conditions must be met. If not, explain what is preventing this from           being possible.
        
              \begin{mdframed}[leftmargin=-6.5mm]
              \textit{Solution}.\\
              %type 2(b) here
              \underline{Yes.} If a relation R is in both BCNF and 3NF, then for every nontrivial FD $X \rightarrow Y$ which held in R, $X$ is a superkey.\\
              \textit{If a relation $R$ is in BCNF, then for all nontrivial FDs in $R$, the LHS of FD is a superkey for $R$.} Based on the property of $R$ explained above, $R$ satisfies this condition, thus $R$ is in BCNF.\\
              \textit{If a relation R is in 3NF, then for each FD $X \rightarrow A$, $X$ is a superkey or $A$ is prime.} Since each FD of R has LHS as the superkey for R based on the properties of R, R satisfies the 3NF property. Therefore R is in 3NF.\\
              Thus R is in both BCNF and 3NF.
              \end{mdframed}
              
    \end{enumerate}
    
    \item Prove or disprove that:
    \begin{enumerate}
        \item If $A \rightarrow B$ then $B \rightarrow C$
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 3(a) here
        \underline{No, } this can be proved by a counterexample.
        \begin{proof}
        Build an instance of a relation $R(A, B, C)$ which has FD set $\{A \rightarrow B\}$ as below.
        
        \begin{center}
        \begin{tabular}{| c | c | c |}
        \hline
        A & B & C\\
        \hline
        \hline
        1 & 2 & 3 \\
        \hline
        1 & 2 & 9 \\
        \hline
        \end{tabular}
        \end{center}
        
        This instance satisfies all the FDs in the relation $R(A, B, C)$, and no tuples violate any FD. However, seen from the instance, C is not determined by B. Thus, $B \nrightarrow C$ even if $A \rightarrow B$ in this instance. \underline{Therefore, if only the FD $A \rightarrow B$ is known, it is not enough to state $B \rightarrow C$.}
        
        \end{proof}
        \end{mdframed}
        
        \item If $AB \rightarrow C$ then $A \rightarrow C$ and $B \rightarrow C$
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 3(b) here
        \underline{No, } this can be proved by a counterexample.
        \begin{proof}
        Build an instance of a relation $R(A, B, C, D)$ which has FD set $\{AB \rightarrow C\}$ as below.
        
        \begin{center}
        \begin{tabular}{| c | c | c | c |}
        \hline
        A & B & C & D\\
        \hline
        \hline
        1 & 2 & 3 & 4 \\
        \hline
        1 & 2 & 3 & 5 \\
        \hline
        1 & 3 & 2 & 6 \\
        \hline
        2 & 2 & 7 & 8 \\
        \hline
        \end{tabular}
        \end{center}
        
        This instance satisfies all the FDs in the relation $R(A, B, C, D)$, and no tuples violate any FD in this instance. However, seen from the instance, C is not determined by A from tuple 1 and 3, and C is not determined by B from tuple 1 and 4. Thus, $A \nrightarrow C$ and $B \nrightarrow C$ even if $AB \rightarrow C$ in this instance. \underline{Therefore, if only the FD $AB \rightarrow C$ is known, it is not enough to state $A \rightarrow C$ and $B \rightarrow C$.}
        
        \end{proof}
        \end{mdframed}
        
    \end{enumerate}
    
    \item \textbf{Design and DDL}
    Consider the following domain:
    You are running a Fresh Juice business with multiple stores around the country, and you want to keep the information for these stores in a relational database. The following is a list of that information:
    \begin{itemize}
        \item Stores: Each store has a city, phone number, and manager. There is only one store per city.
        \item Beverages: Each juice beverage has a name (e.g. ‘Kiwi Lime’), and a number of calories for a regular and large size. A large size always has 200 more calories than the regular size. Every store should keep track of the number of inventory of each beverage (how much it has left in stock).
        \item Transactions: When a customer makes an order, that order should have a date, price, and an indication of which loyalty card was used, if applicable. You can assume one beverage is ordered per transaction, and we should know what that beverage was.
        \item Loyalty card: Customers can have a loyalty card if they like to go to your stores a lot. There needs to be information on how many transactions a customer made with the card, and their ‘home store’ (the one they go to most frequently).
    \end{itemize}
    
    \begin{enumerate}
        \item Define a \textbf{single} relation for this domain that manages to store all of the required information (just write it out \textit{R(...)}, no need for SQL definitions yet). There is not necessarily one correct answer for this relation, but the information should be stored in a practically useful way. It is ok to add attributes that aren't explicitly listed in the domain as long as they are useful.
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        $R(Store\_id, City, phone\_number, manager, transaction\_id, tran\_date, tran\_price,\\ loyalty\_card\_id, card\_home\_store, number\_of\_tran\_in\_card, \\ beverage\_id, name\_of\_beverage\_sold, beverage\_regular\_calories, \\ beverage\_large\_calories, amount)$
        \end{mdframed}
        
        \item Write all of the functional dependencies for your relation that would be inferred by the description of this domain. Do not include trivial or redundant FDs (find a minimal basis).
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        Store\_id $\to$ City, Store\_id $\to$ phone\_number, Store\_id $\to$ manager,\\
        transaction\_id $\to$ tran\_date, transaction\_id $\to$ tran\_price, transaction\_id $\to$ loyalty\_card\_id,\\
        transaction\_id $\to$ name\_of\_beverage\_sold\\
        loyalty\_card\_id $\to$ number\_of\_tran\_in\_card, loyalty\_card\_id $\to$ card\_home\_store,\\
        beverage\_id $\to$ name\_of\_beverage\_sold,
        beverage\_id $\to$ beverage\_regular\_calories,\\
        beverage\_id $\to$ beverage\_large\_calories, \\
        store\_id, beverage\_id $\to$ amount
        
        \end{mdframed}
        
        \item Provide a useful instance of your relation that shows all three types of anomalies. Describe the anomalies you have presented as they appear in your particular instance (give an example for each of the three anomalies in your relation).
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
\begin{center}
\begin{tabular}{| c | c | c | c | c | c | c |}
\hline
Store\_id & City      & phone\_number & manager & transaction\_id & tran\_date & tran\_price\\
\hline
1     & Toronto   & 111-111-1111  & Peter   & 1           & 01/11      & 10         \\
\hline
2     & Vancouver & 222-222-2222  & Daniel  & 2           & 01/11      & 20         \\
\hline
3     & Ottawa    & 333-333-3333  & James   & 3           & 01/11      & 15         \\
\hline
1     & Toronto   & 111-111-111   & Peter   & 4           & 01/11      & 5          \\
\hline
1     & Toronto   & 111-111-111   & Peter   & 5           & 01/11      &18          \\
\hline
\end{tabular}
\end{center}
\textbf{continue with}
\begin{center}
\begin{tabular}{| c | c | c | c | c |}
\hline
loyalty\_card\_id & card\_home\_store & number\_of\_tran\_in\_card & beverage\_id & name\_of\_beverage\_sold \\
\hline
123456        & 1                 & 4            & 123              & orange\\
\hline
234567        & 1                 & 5            & 456              & apple \\
\hline
123456        & 1                 & 4            & 789              & banana \\
\hline
345678        & 3                 & 6            & 101112              & grape\\
\hline
456789        & 2                 & 10           & 121314              & watermelon\\
\hline
\end{tabular}
\end{center}
\textbf{continue with}
\begin{center}
\begin{tabular}{| c | c | c | c |}
\hline
beverage\_regular\_calories & beverage\_large\_calories & amount \\
\hline
100                         & 300                   & 50              \\
\hline
100                         & 300                & 40              \\
\hline
300                         & 500                  & 30              \\
\hline
200                       & 400                & 20 \\
\hline
150                       & 350                 & 40 \\
\hline
\end{tabular}
\end{center}
\textbf{Redundancy:} Lots of duplicate information for store with Store\_id 1 in Toronto tuple.\\
\textbf{Update:} Change number\_of\_tran\_in\_card for loyalty\_card with loyalty\_card\_id 123456 in one tuple requires updating all tuples with loyalty\_card\_id 123456.\\
\textbf{Deletion:} Delete 4 as a transaction\_id can remove the tuple with loyalty\_card\_id 345678 entirely.
        \end{mdframed}
        
        \item Your relation will likely (read certainly) have some redundancy. Decompose your relation into a set of relations without any BCNF violations. Write all of your steps in full and clearly show why your relations do not violate BCNF.
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 4(d) here
        Let $R$ be the original relation and $F$ be the set of all FDs. In order to decompose this relation to all new relations that does not have any BCNF violations, execute the algorithm BCNF\_decomp($R$, $F$).\\
        \begin{itemize}[leftmargin=16mm]
            \item [\textbf{Step 0. }]run BCNF\_decom($R$, $F$).\\
            \textbf{Detail:} find one LHS of FD in $F$, \texttt{(store\_id, beverage\_id)}, is not a superkey, thus the FD with \texttt{(store\_id, beverage\_id)}, is not in BCNF.\\
            Let
            \begin{gather*}
                R_0 = (store\_id, beverage\_id)^+ = (store\_id, beverage\_id, amount) \\
                R_{0.5} = R - ((store\_id, beverage\_id)^+ - (store\_id, beverage\_id)) = (store\_id, \\ city, phone\_number, manager, \\
                transaction\_id, tran\_date, tran\_price, \\ loyality\_card\_id, beverage\_id, name\_of\_beverage\_sold, number\_of\_tran\_in\_card, \\ card\_home\_store, beverage\_regular\_calories, \\
                beverage\_large\_calories)
            \end{gather*}
            Then project FDs onto $R_0$ and $R_{0.5}$. $R_0$ is in BCNF but $R_{0.5}$ not in BCNF.
            
            \item [\textbf{Step 1. }]run BCNF\_decom($R_{0.5}$, $F_{0.5}$).\\
            \textbf{Detail:} find one LHS of FD in $F_{0.5}$, \texttt{store\_id}, is not a super key, thus the FD with \texttt{store\_id}, is not in BCNF.\\
            Let
            \begin{gather*}
                R_1 = store\_id^+ = (store\_id, city, phone\_number, manager) \\
                R_2 = R - (store\_id^+ - store\_id) = (store\_id, transaction\_id, tran\_date, tran\_price, \\ loyality\_card\_id, beverage\_id, name\_of\_beverage\_sold, number\_of\_tran\_in\_card, \\ card\_home\_store, beverage\_regular\_calories, \\
                beverage\_large\_calories)
            \end{gather*}
            Then project FDs onto $R_1$ and $R_2$. $R_1$ is in BCNF but $R_2$ not in BCNF.
            
            \item[\textbf{Step 2. }]run BCNF\_decom($R_2$, $F_2$), $F_2$ is the set of FDs projected on $R_2$ from $F$.\\
            \textbf{Detail:} find one LHS of FD in $F_2$, \texttt{transaction\_id}, is not a super key, thus the FD with \texttt{transaction\_id}, is not in BCNF.\\
            Let\\
            \begin{gather*}
                R_3 = transaction\_id^+ = (transaction\_id, tran\_date, tran\_price, loyality\_card\_id, beverage\_id\\
                name\_of\_beverage\_sold, number\_of\_tran\_in\_card, card\_home\_store,\\ beverage\_regular\_calories,
                beverage\_large\_calories)\\
                R_4 = R_2 - (transaction\_id^+ - transaction\_id) = (store\_id, transaction\_id)
            \end{gather*}
            Then project FDs onto $R_3$ and $R_4$. $R_4$ is in BCNF but $R_3$ not in BCNF.
            
            \item[\textbf{Step 3. }]run BCNF\_decom($R_3$, $F_3$), $F_3$ is the set of FDs projected on $R_3$ from $F_2$.\\
            \textbf{Detail:} find one LHS of FD in $F_3$, \texttt{loyality\_card\_id}, is not a super key, thus the FD with \texttt{loyality\_card\_id}, is not in BCNF.\\
            Let\\
            \begin{gather*}
                R_5 = loyality\_card\_id^+ = (number\_of\_tran\_in\_card, card\_home\_store, loyality\_card\_id)\\
                R_6 = R_3 - (loyality\_card\_id^+ - loyality\_card\_id) = (transaction\_id, tran\_date, tran\_price,\\ loyality\_card\_id, beverage\_id, name\_of\_beverage\_sold, beverage\_regular\_calories,\\
                beverage\_large\_calories)
            \end{gather*}
             Then project FDs onto $R_5$ and $R_6$. $R_5$ is in BCNF but $R_6$ not in BCNF.
             
             \item[\textbf{Step 4. }]run BCNF\_decom($R_6$, $F_6$), $F_6$ is the set of FDs projected on $R_6$ from $F_3$.\\
            \textbf{Detail:} find one LHS of FD in $F_6$, \texttt{beverage\_id}, is not a superkey, thus the FD with \texttt{beverage\_id}, is not in BCNF.\\
            Let\\
            \begin{gather*}
                R_7 = beverage\_id^+ = (beverage\_id^+, name\_of\_beverage\_sold, \\
                 beverage\_regular\_calories, beverage\_large\_calories)\\
                R_8 = R_6 - (beverage\_id^+ - beverage\_id) = (transaction\_id, \\
                tran\_date, tran\_price, loyality\_card\_id, beverage\_id)
            \end{gather*}
            Then project FDs onto $R_7$ and $R_8$. $R_7$ and $R_8$ are both in BCNF.
            \item[\textbf{Step 4. }]run BCNF\_decom($R_6$, $F_6$), $F_6$ is the set of FDs projected on $R_6$ from $F_3$.\\
            \textbf{Detail:} find one LHS of FD in $F_6$, \texttt{beverage\_id}, is not a superkey, thus the FD with \texttt{beverage\_id}, is not in BCNF.\\
            Let\\
        \end{itemize}
        Finally, the new relations are
        \begin{gather*}
            R_0(store\_id, beverage\_id, amount) \\
            R_1(city, phone\_number, manager, store\_id) \\
            R_4(transaction\_id, store\_id) \\
            R_5(card\_home\_store, number\_of\_tran\_in\_card, loyality\_card\_id) \\
            R_7(beverage\_id, name\_of\_beverage\_sold,
                 beverage\_regular\_calories, beverage\_large\_calories) \\
            R_8(transaction\_id, tran\_date, tran\_price, loyality\_card\_id, name\_of\_beverage\_sold)
        \end{gather*}
        \end{mdframed}
        
        \item Explain how your new relations prevent the anomalies you pointed out in part (c).
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        \textbf{Redundancy:} City is suerkey in R1 and one store per city, therefore, it will no duplicate information for Store\_id 1 in Toronto tuple.\\
        \textbf{Update:} loyality\_card\_id is superkey in R5, therefore, there is only one tuple whose card is 123456, only change number\_of\_tran\_card for 123456 once.\\
        \textbf{Deletion:} When we delete 4 as transaction\_id, it will delete one tuple form R4 and R8 respectively and we will preserve loyalty\_card\_id 345678 in R5.
        \end{mdframed}
        
        \item \textbf{SQL DDL:}\\
        Using your new relations from part (d), create a schema using the SQL DDL language. They should have proper relation names, attribute names and types, and constraints (including keys, foreign key, unique, not null, etc.).\\
        You should add \textbf{comments} above each table and attribute describing what it represents. You can add comments using a double dash \texttt{--}. You should also insert some useful data into each of the relations (directly in the ddl file, not through csv).\\
        Use the DDL files from the lectures and A2 as examples to help you make them. Unlike A2, you do not need to write any SQL queries for this part.
        
        \begin{mdframed}[leftmargin=-6.5mm]
        \textit{Solution}.\\
        %type 4(f) here
        Our schema is in the file \texttt{fruits.ddl} with some insertions for our demo,\\
        and the demo is in the file \texttt{fruits-demo.txt}.
        \end{mdframed}
        
    \end{enumerate}
    
    \textbf{What to hand in for this part:}
    In your A3.pdf file, describe the decisions for any constraints you put in your DDL file. Hand in a file called \texttt{fruits.ddl} containing your schema, as well as a plain text file called \texttt{fruits-demo.txt} that shows you starting postgreSQL, successfully importing fruits.ddl, and exiting posgreSQL. This is similar to what you did in the preps. You must hand in this demo and the file must be a plain text file or you get \textbf{zero} for this part of the assignment.
\end{enumerate}

\newpage
\section*{Submission instructions}
Your assignment must be typed; handwritten assignments will not be marked. You may use any word- processing software you like.\\
For this assignment, hand in a file A3.pdf that contains your answers to the questions above. Also hand in \texttt{fruits.ddl} and \texttt{fruits-demo.txt}.\\
You must declare your team and hand in your work electronically using the MarkUs online system. Well before the due date, you should declare your team and try submitting with MarkUs.


\end{document}
